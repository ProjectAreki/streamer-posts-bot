# 📊 Ответы на вопросы о промптах и форматировании

## Вопрос 1: У нас так же 6 промптов?

### ✅ Да, у нас 6 промптов для видео!

```python
# В методе _get_system_prompt() (строка 1852):
all_prompts = [
    self.SYSTEM_PROMPT,              # ПРОМПТ 1
    self.SYSTEM_PROMPT_ARCHITECT,    # ПРОМПТ 2
    self.SYSTEM_PROMPT_3,            # ПРОМПТ 3
    self.SYSTEM_PROMPT_4,            # ПРОМПТ 4
    self.SYSTEM_PROMPT_5,            # ПРОМПТ 5
    self.SYSTEM_PROMPT_6             # ПРОМПТ 6
]
```

### 📍 Где находятся:

| Промпт | Переменная | Строка | Описание |
|--------|-----------|--------|----------|
| 1 | `SYSTEM_PROMPT` | ~1213 | Копирайтер для Telegram-канала |
| 2 | `SYSTEM_PROMPT_ARCHITECT` | ~360 | Архитектор вирусного контента |
| 3 | `SYSTEM_PROMPT_3` | ~574 | Гуру вовлекающих текстов |
| 4 | `SYSTEM_PROMPT_4` | ~718 | Гений контента (вирусные эмоции) |
| 5 | `SYSTEM_PROMPT_5` | ~881 | Архитектор вирусного контента v2 |
| 6 | `SYSTEM_PROMPT_6` | ~1060 | Креативный контент-мейкер |

### 🔄 Как работает ротация:

```python
# Строка 1863-1869
if self._prompt_counter % 6 == 0:
    # Строгая ротация каждые 6 постов
    prompt_index = (self._prompt_counter // 6) % 6
    return all_prompts[prompt_index]
else:
    # Случайная ротация между строгими циклами
    return random.choice(all_prompts)
```

**Принцип:**
- Каждый 6-й пост: строгая последовательность (1→2→3→4→5→6)
- Остальные посты: случайный выбор из всех 6

**Результат:** Максимальное разнообразие стилей!

---

## Вопрос 2: Кто делает форматирование текста - код или AI?

### 🎯 Ответ: ОБА! Гибридный подход

## 1️⃣ AI делает основное форматирование (95%)

### Что указано в промптах:

```
📝 HTML-ТЕГИ (используй ВСЕ, не только один!):
• <b>жирный</b> — слоты, имена, акценты, заголовки
• <i>курсив</i> — цитаты, пояснения, мысли вслух
• <u>подчёркнутый</u> — заголовки блоков, важное
• <code>моноширный</code> — ВСЕ цифры, суммы, множители
• <b><i>жирный курсив</i></b> — особые акценты

🔢 ВСЕ ЦИФРЫ ТОЛЬКО В <code>тегах</code>!
• Вход: <code>500₽</code> ✅
• Итог: <code>1 130 675₽</code> ✅  
• Множитель: <code>x2261.3</code> ✅
```

**AI генерирует текст УЖЕ с HTML тегами:**
- `<b>Жирный</b>` для акцентов
- `<i>Курсив</i>` для пояснений
- `<code>500₽</code>` для всех цифр
- `<a href="URL">Текст ссылки</a>` для гиперссылок

---

## 2️⃣ Код делает постобработку (5%)

### Метод `_apply_random_formatting()` (строка 2095)

**НЕ используется в основной генерации!** Это запасной метод.

### Что он может делать:

```python
def _apply_random_formatting(self, text: str) -> str:
    """
    Применяет рандомное HTML форматирование к каждой строке текста.
    
    Форматы:
    1. <b>жирный</b>
    2. <i>курсив</i>
    3. <b><i>жирный курсив</i></b>
    4. <u>подчёркнутый</u>
    5. <code>моноширный</code>
    6. <tg-spoiler>спойлер</tg-spoiler>
    7. <blockquote>цитата</blockquote>
    8. без форматирования
    """
```

**НО!** Этот метод:
- ❌ Не вызывается в основном потоке генерации
- ❌ Не используется для постов стримеров
- ✅ Существует как утилита (возможно для других сценариев)

---

## 3️⃣ Код делает обязательную очистку

### Что код ВСЕГДА делает:

#### A. Замена украинских букв (строка 2483-2489):
```python
ukr_to_rus = {
    'і': 'и', 'І': 'И',
    'ї': 'и', 'Ї': 'И',
    'є': 'е', 'Є': 'Е',
    'ґ': 'г', 'Ґ': 'Г'
}
text = text.replace('Выхід', 'Выход')
```

#### B. Удаление маркеров (строка 2962-2964):
```python
for marker in ["JSON", "```", "```json"]:
    raw_text = raw_text.replace(marker, "")
text = text.strip()
```

#### C. Обрезка по лимиту Telegram (1024 символа)

#### D. Вставка ссылок с бонусами (если AI не добавил)

---

## 📊 Итоговая схема:

```
┌─────────────────────────────────────────────────┐
│  1. AI ГЕНЕРИРУЕТ ТЕКСТ (95% работы)            │
│     • Выбирает структуру                        │
│     • Создаёт контент                           │
│     • ПРИМЕНЯЕТ HTML теги:                      │
│       - <b>Жирный</b>                           │
│       - <i>Курсив</i>                           │
│       - <code>Цифры</code>                      │
│       - <a href>Ссылки</a>                      │
│     • Добавляет эмодзи                          │
└─────────────────┬───────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────┐
│  2. КОД ДЕЛАЕТ ПОСТОБРАБОТКУ (5% работы)        │
│     • Замена украинских букв → русские          │
│     • Удаление технических маркеров             │
│     • Проверка лимита 1024 символа              │
│     • Вставка ссылок (если AI забыл)            │
│     • .strip() (удаление лишних пробелов)       │
└─────────────────┬───────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────┐
│  3. ГОТОВЫЙ ПОСТ С HTML ФОРМАТИРОВАНИЕМ         │
│     Отправляется в Telegram через aiogram       │
│     с параметром parse_mode="HTML"              │
└─────────────────────────────────────────────────┘
```

---

## 🎯 Вывод:

1. **6 промптов** ✅ - да, для видео используется 6 разных промптов
2. **Форматирование** ✅ - делает в основном AI (95%), код только чистит (5%)

### Преимущества такого подхода:

✅ **AI творит свободно** - создаёт уникальные структуры и стили
✅ **Код контролирует** - убирает технические артефакты
✅ **HTML надёжен** - работает во всех Telegram клиентах
✅ **Разнообразие** - 6 промптов × случайная ротация = максимум вариаций

---

**Документировал:** AI Assistant  
**Дата:** 15 января 2026
